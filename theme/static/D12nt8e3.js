import{m as i,f as r,a as o,T as l}from"./vendor.s2Y4qQG_.js";document.addEventListener("alpine:init",()=>{i.store("context",{}),i.data("removeEmptyHeader",()=>({init(){this.$el.innerText.length==0&&this.$el.remove()}})),i.data("showToggler",()=>({open:!1,toggle(){this.open=!this.open}})),i.data("autofocusing",()=>({init(){this.$el.querySelector('input:not([type="hidden"])').focus()}})),i.data("nav",()=>({open:!1,navLinksList:null,init(){this.navLinksList=document.querySelector(".links-list"),this.navLinksList.style.maxHeight="0px"},toggle(){this.navLinksList.style.maxHeight==="0px"?this.navLinksList.style.maxHeight=this.navLinksList.scrollHeight+"px":this.navLinksList.style.maxHeight="0px",this.open=!this.open}})),i.data("chipsPicker",()=>({tags:[],tagsFull:!1,tagsList:null,autoCompleteList:null,autoCompleteListItems:null,currentInput:null,init(){this.tagsList=this.$refs.tagsList,this.autoCompleteList=this.$el.querySelector(".auto-complete-list"),this.autoCompleteList.style.display="none",this.autoCompleteListItems=this.autoCompleteList.querySelectorAll("li"),this.$store.context.chipsPicker={id:this.$id("chipsPicker"),getAllTagsStr:()=>this.getAllTagsStr(),loadPostTags:()=>this.loadPostTags(),loadPostTag:()=>this.loadPostTag()}},switchChipMode(t){this.tags.map(e=>(e.id==t.dataset.tagId&&(e.value=t.value,e.mode="view",this.currentInput=null),e)),this.tags.length<4?(this.tags.push({id:crypto.randomUUID(),value:"",mode:"edit"}),this.$nextTick(()=>this.tagsList.querySelector("li:last-of-type input").focus())):this.tags.length===4&&(this.tagsFull=!0)},addNewTag(){this.autoCompleteList.style.display="none",this.$el.value.trim().length>0&&this.switchChipMode(this.$el)},removeTag(t){this.tags=[...this.tags.filter(e=>e.id!==t)],this.tagsFull&&(this.tagsFull=!1,this.$nextTick(()=>this.tags.push({id:crypto.randomUUID(),value:"",mode:"edit"})))},pickTag(){this.currentInput.value=this.$el.innerText,this.switchChipMode(this.currentInput),this.autoCompleteList.style.display="none"},typing(){if(this.currentInput==null&&(this.currentInput=this.$el),this.$el.value.length>0){this.autoCompleteList.style.display="block";for(let t=0;t<this.autoCompleteListItems.length;t++)this.autoCompleteListItems[t].textContent.toLowerCase().includes(this.$el.value)?this.autoCompleteListItems[t].style.display="":this.autoCompleteListItems[t].style.display="none"}},getAllTagsStr(){const t=this.$refs.tagsList.querySelectorAll("li input");return Array.from(t).map(s=>s.value.trim()).filter(Boolean).join()},loadPostTags(){const t=this.$el.querySelectorAll(".current-post-tags li");for(let e of t)this.tags.push({id:crypto.randomUUID(),value:e.innerHTML,mode:"view"});t.length<4?this.tags.push({id:crypto.randomUUID(),value:"",mode:"edit"}):t.length==4&&(this.tagsFull=!0)},loadPostTag(){this.tags.push({id:crypto.randomUUID(),value:"",mode:"edit"})}})),i.data("profileForm",()=>({init(){r("#id_date_of_birth",{}),this.$refs.photoInput.addEventListener("change",t=>{const e=t.target.files[0];if(e){const s=new FileReader;s.onload=a=>{this.$refs.photoImg.src=a.target.result},s.readAsDataURL(e)}})},openPhotoImgInput(){this.$refs.photoInput.click()}})),i.data("newPostForm",()=>({editor:null,csrftoken:null,init(){this.csrftoken=o.get("csrftoken"),this.editor=new l({el:this.$el.querySelector("#markdown-editor"),height:"31.25rem",initialEditType:"markdown",previewStyle:"tab",theme:"dark",hideModeSwitch:!0}),this.$nextTick(()=>this.$store.context.chipsPicker.loadPostTag())},async post(t){const e=this.$store.context.chipsPicker.getAllTagsStr(),s=new FormData;s.append("action",t),s.append("title",this.$refs.title.value),s.append("body",this.editor.getMarkdown()),s.append("tags",e);const n=await(await fetch("/posts/new/",{method:"POST",headers:{"X-CSRFToken":this.csrftoken},mode:"same-origin",body:s})).json();window.location.assign(n.url)}})),i.data("updatePostForm",()=>({editor:null,id:null,csrftoken:null,init(){this.$nextTick(()=>this.$store.context.chipsPicker.loadPostTags()),this.csrftoken=o.get("csrftoken"),this.id=this.$el.dataset.id;const t=this.$el.querySelector("#markdown-editor");this.editor=new l({el:t,height:"31.25rem",initialEditType:"markdown",previewStyle:"tab",theme:"dark",hideModeSwitch:!0,initialValue:t.textContent.trim()})},async update(){const t=this.$store.context.chipsPicker.getAllTagsStr(),e=new FormData;e.append("title",this.$refs.title.value),e.append("body",this.editor.getMarkdown()),e.append("tags",t);const a=await(await fetch(`/posts/${this.id}/edit/`,{method:"POST",headers:{"X-CSRFToken":this.csrftoken},mode:"same-origin",body:e})).json();window.location.assign(a.url)},cancel(){history.back()}})),i.data("postsList",()=>({page:1,isFetching:!1,emptyPage:!1,postsMainList:null,init(){this.postsMainList=this.$el.querySelector("ul.main-list"),window.addEventListener("scroll",()=>{const t=document.body.clientHeight-window.innerHeight-200;window.scrollY>t&&!this.emptyPage&&!this.isFetching&&this.fetchPosts()})},async fetchPosts(){this.page++,this.isFetching=!0;const e=await(await fetch(`?list_paginated=1&page=${this.page}`)).text();e==""?this.emptyPage=!0:this.postsMainList.insertAdjacentHTML("beforeend",e),this.isFetching=!1}})),i.data("commentReplyBoxCtrl",()=>({open:!1,openUpdateForm:!1,toggle(){this.open=!this.open},toggleUpdateForm(){this.openUpdateForm=!this.openUpdateForm,this.open=!this.open},closeUpdateForm(){this.openUpdateForm=!1}})),i.data("likeItem",t=>({itemId:null,csrftoken:null,likeStatus:null,pending:null,totalLikes:0,init(){this.itemId=this.$el.dataset.itemId,this.csrftoken=o.get("csrftoken"),this.likeStatus=this.$el.dataset.isLiked==="True"?"fill":"empty",this.totalLikes=parseInt(this.$el.dataset.totalLikes)||0},async toggle(e=""){if(this.pending)return;this.pending=!0;const s=new FormData;s.append("id",this.itemId),s.append("action",e),(await(await fetch(t,{method:"POST",headers:{"X-CSRFToken":this.csrftoken},mode:"same-origin",body:s})).json()).action=="like"?(this.likeStatus="fill",this.totalLikes+=1):(this.likeStatus="empty",this.totalLikes-=1),this.pending=!1}})),i.data("postBookmark",()=>({open:!1,postId:null,csrftoken:null,totalBookmarks:0,pending:!1,init(){this.postId=this.$el.dataset.postId,this.csrftoken=o.get("csrftoken"),this.totalBookmarks=parseInt(this.$el.dataset.totalBookmarks)||0,this.open=this.$el.dataset.status=="True"},async bookmark(t){if(this.pending)return;this.pending=!0;const e=new FormData;e.append("action",t),(await(await fetch(`/posts/${this.postId}/bookmark/`,{method:"POST",headers:{"X-CSRFToken":this.csrftoken},mode:"same-origin",body:e})).json()).action=="bookmark"?(this.open=!0,this.totalBookmarks+=1):(this.open=!1,this.totalBookmarks-=1),this.pending=!1}}))});i.start();
